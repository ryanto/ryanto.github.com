<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>EmberJS Testing</title>
  <link rel="stylesheet" 
    href="http://cdnjs.cloudflare.com/ajax/libs/qunit/1.11.0/qunit.min.css">
</head>
<body>
  <div id="qunit"></div>
  <div id="qunit-fixture"></div>

  <script type="text/javascript"
    src="http://cdnjs.cloudflare.com/ajax/libs/qunit/1.11.0/qunit.min.js"></script>
  <script type="text/javascript"
    src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.10.2/jquery.js"></script>
  <script type="text/javascript"
    src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0/handlebars.min.js"></script>

  <script type="text/javascript"
    src="http://builds.emberjs.com/ember-1.0.0-rc.7.js"></script>

  <script type="text/javascript">
    App = Ember.Application.create({
      rootElement: '#qunit-fixture'
    });

    App.Post = Ember.Object.extend();

    App.PostsController = Ember.ArrayController.extend();

    App.PostController = Ember.ObjectController.extend({
      needs: 'posts'.w(),

      selected: Ember.computed.equal('model', 'controllers.posts.selected'),

      title: function() {
        return this.get('model.title').toUpperCase();
      }.property('model.title')
    });

    // begin tests

    var model, controller;

    module("Post Controller 'Use the Container' Test", {
      setup: function() {
        App.reset();
        controller = App.__container__.lookup('controller:post');
        model = App.Post.create();
        controller.set('model', model);
      },
      teardown: function() {
        controller = null;
        model = null;
      }
    });

    test("it should capitalize the title", function() {
      model.set('title', 'hello world');
      equal(controller.get('title'), "HELLO WORLD", 'all caps title');
    });


    module("Post Controller 'Fake the Container' Test", {
      setup: function() {
        var container = new Ember.Container();

        // an empty object will act as our PostsController
        container.register('controller:posts', {});

        // pass in our container
        controller = App.PostController.create({ container: container });
        model = App.Post.create();

        controller.set('model', model);
      },

      teardown: function() {
        controller = null;
        model = null;
      }
    });

    test("it should capitalize the title", function() {
      model.set('title', 'testing testing');
      equal(controller.get('title'), "TESTING TESTING", 'all caps title');
    });
  </script>
</body>
</html>
